<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <!-- =================== PRAVILA ======================= -->

    <record id="hr_salary_rule_rr" model="hr.salary.rule">
        <field name="name">Redovan rad</field>
        <field name="sequence" eval="5" />
        <field name="code">REDRAD</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
radni_sati = worked_days.TSH_10_SF.number_of_hours + worked_days.TSH_11_S.number_of_hours
result_qty = radni_sati
result = contract.br_bod * float(payslip.rule_parameter('VRBOD'))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_dpraz" model="hr.salary.rule">
        <field name="name">Državni praznik</field>
        <field name="sequence" eval="7" />
        <field name="code">DPRAZ</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.DRZAVNI_PRAZNIK and abs(worked_days.DRZAVNI_PRAZNIK.number_of_hours)
# kao redovan rad
result = contract.br_bod * float(payslip.rule_parameter('VRBOD'))
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>


    <record id="hr_salary_rule_godis" model="hr.salary.rule">
        <field name="name">Godišnji odmor</field>
        <field name="sequence" eval="8" />
        <field name="code">GODIS</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.ODMOR and abs(worked_days.ODMOR.number_of_hours)
# isto se boduje kao redovan rad
result = contract.br_bod * float(payslip.rule_parameter('VRBOD'))
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
      <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_bolov" model="hr.salary.rule">
        <field name="name">Bolovanje do 42d (90%)</field>
        <field name="sequence" eval="9" />
        <field name="code">BOLOV</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.BOLOVANJE and abs(worked_days.BOLOVANJE.number_of_hours)
# redovan rad 90%
result = contract.br_bod * float(payslip.rule_parameter('VRBOD')) * 0.9
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_nr" model="hr.salary.rule">
        <field name="name">Noćni rad</field>
        <field name="sequence" eval="11" />
        <field name="code">NOCNI</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
radni_sati = worked_days.TSH_20_NF.number_of_hours + worked_days.TSH_21_N.number_of_hours
result_qty = radni_sati
result = contract.br_bod * float(payslip.rule_parameter('VRBOD')) * 1.5
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>
<!--
    <record id="hr_salary_rule_prerasp" model="hr.salary.rule">
        <field name="name">Preraspodjele</field>
        <field name="sequence" eval="12" />
        <field name="code">PRERASP</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty = 0
result = contract.br_bod * float(payslip.rule_parameter('VRBOD'))
        </field>
    </record>
-->

    <record id="hr_salary_rule_mr" model="hr.salary.rule">
        <field name="name">Minuli rad</field>
        <field name="sequence" eval="12" />
        <field name="code">MINRAD</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty = 1
zaok = int(payslip.rule_parameter('ZAOK'))
result_rate = contract.koef_mr
result = round(result_rules.REDRAD.amount * result_rules.REDRAD.quantity, zaok)
result += round(result_rules.DPRAZ.amount * result_rules.DPRAZ.quantity, zaok)
result += round(result_rules.GODIS.amount * result_rules.GODIS.quantity, zaok)
result += round(result_rules.BOLOV.amount * result_rules.BOLOV.quantity, zaok)
result += round(result_rules.NOCNI.amount * result_rules.NOCNI.quantity, zaok)
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>


    <record id="hr_salary_rule_roditelj" model="hr.salary.rule">
        <field name="name">Roditeljsko odsustvo (0%)</field>
        <field name="sequence" eval="15" />
        <field name="code">ROD_ODS</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.RODITELJSKO_ODSUSTVO and abs(worked_days.RODITELJSKO_ODSUSTVO.number_of_hours)
# redovan rad 0%
result = contract.br_bod * float(payslip.rule_parameter('VRBOD')) * 0.0
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>


    <record id="hr_salary_rule_r_dpraz" model="hr.salary.rule">
        <field name="name">Rad na državni praznik (+100%)</field>
        <field name="sequence" eval="17" />
        <field name="code">R_DPRAZ</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.TSH_30_WF and abs(worked_days.TSH_30_WF.number_of_hours)
result_qty +=  worked_days.TSH_31_WF and abs(worked_days.TSH_31_WF.number_of_hours)
# kao redovan rad
result = contract.br_bod * float(payslip.rule_parameter('VRBOD'))
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_ceka" model="hr.salary.rule">
        <field name="name">Čekanje (granski ugovor metalci)</field>
        <field name="sequence" eval="16" />
        <field name="code">CEKANJE</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.REST and abs(worked_days.REST.number_of_hours)
min_met = result_qty * float(payslip.rule_parameter('MNS_MET_FBIH'))
#min = result_qty * float(payslip.rule_parameter('MNS_FBIH'))
result = min_met
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_kor_min" model="hr.salary.rule">
        <field name="name">Korekcija - minimum po opštem kolektivnom ugovoru</field>
        <field name="sequence" eval="17" />
        <field name="code">KOREK</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
odsustva = worked_days.BOLOVANJE and abs(worked_days.BOLOVANJE.number_of_hours)
odsustva += worked_days.ODMOR and abs(worked_days.ODMOR.number_of_hours)
odsustva += worked_days.RODITELJSKO_ODSUSTVO and abs(worked_days.RODITELJSKO_ODSUSTVO.number_of_hours)
radni_sati = worked_days.TSH_10_SF.number_of_hours + worked_days.TSH_11_S.number_of_hours
radni_sati += worked_days.TSH_20_NF.number_of_hours + worked_days.TSH_21_N.number_of_hours
result_qty = radni_sati - odsustva
neto = result_qty * (1 + contract.koef_mr / 100.00) * contract.br_bod * float(payslip.rule_parameter('VRBOD'))
min = result_qty * float(payslip.rule_parameter('MNS_FBIH'))
result = 0
if min > neto:
    result = (min - neto) / result_qty
if result == 0:
    result_qty = 0
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>


    <record id="hr_salary_rule_kor_min_met" model="hr.salary.rule">
        <field name="name">Korekcija - minimum po kolektivnom ugovoru METAL</field>
        <field name="sequence" eval="18" />
        <field name="code">KOREK_MET</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
odsustva = worked_days.BOLOVANJE and abs(worked_days.BOLOVANJE.number_of_hours)
odsustva += worked_days.ODMOR and abs(worked_days.ODMOR.number_of_hours)
odsustva += worked_days.RODITELJSKO_ODSUSTVO and abs(worked_days.RODITELJSKO_ODSUSTVO.number_of_hours)
radni_sati = worked_days.TSH_10_SF.number_of_hours + worked_days.TSH_11_S.number_of_hours
radni_sati += worked_days.TSH_20_NF.number_of_hours + worked_days.TSH_21_N.number_of_hours
result_qty = radni_sati - odsustva
neto = result_qty * (1 + contract.koef_mr / 100.00) * contract.br_bod * float(payslip.rule_parameter('VRBOD'))
min_met = result_qty * float(payslip.rule_parameter('MNS_MET_FBIH'))
result = 0
if min_met > neto:
   result = (min_met - neto) / result_qty
if result == 0:
   result_qty = 0
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>


    <record id="hr_salary_rule_to" model="hr.salary.rule">
        <field name="name">Topli obrok (neoporeziva naknada)</field>
        <field name="sequence" eval="19" />
        <field name="code">TO</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NAKN" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.FOOD and worked_days.FOOD.number_of_days
# dnevno 1% prosjecne plate FBiH
result = float(payslip.rule_parameter('PROS_N_P_FBIH')) * 1 / 100.00
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_to_o" model="hr.salary.rule">
        <field name="name">Topli obrok (oporezivi dio)</field>
        <field name="sequence" eval="20" />
        <field name="code">TO_O</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_SUB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty =  worked_days.FOOD and worked_days.FOOD.number_of_days
to_neopor = float(payslip.rule_parameter('PROS_N_P_FBIH')) * 1 / 100.00
result = float(payslip.rule_parameter('TO_DAN')) - to_neopor
if result &lt;= 0:
    result_qty = 0
    result = 0
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_neto" model="hr.salary.rule">
        <field name="name">Neto plata prije poreza</field>
        <field name="sequence" eval="50" />
        <field name="code">NETO</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_qty = 1
# quantity, rate, amount, total
result = ( round(result_rules.REDRAD.amount,2) * round(result_rules.REDRAD.quantity,2) * round(result_rules.REDRAD.rate,2)/100 +
           round(result_rules.MINRAD.amount,2) * round(result_rules.MINRAD.quantity,2) * round(result_rules.MINRAD.rate,2)/100 +
           round(result_rules.NOCNI.amount,2) * round(result_rules.NOCNI.quantity,2) * round(result_rules.NOCNI.rate,2)/100 +
           round(result_rules.CEKANJE.amount,2) * round(result_rules.CEKANJE.quantity,2) * round(result_rules.CEKANJE.rate,2)/100 +
           round(result_rules.R_DPRAZ.amount,2) * round(result_rules.R_DPRAZ.quantity,2) * round(result_rules.R_DPRAZ.rate,2)/100 +
           round(result_rules.GODIS.amount,2) * round(result_rules.GODIS.quantity,2) * round(result_rules.GODIS.rate,2)/100 +
           round(result_rules.BOLOV.amount,2) * round(result_rules.BOLOV.quantity,2) * round(result_rules.BOLOV.rate,2)/100 if result_rules.BOLOV else 0 +
           round(result_rules.DPRAZ.amount,2) * round(result_rules.DPRAZ.quantity,2) * round(result_rules.DPRAZ.rate,2)/100 +
           round(result_rules.TO_O.amount,2) * round(result_rules.TO_O.quantity,2) * round(result_rules.TO_O.rate,2)/100 +
           round(result_rules.KOREK_MET.amount,2) * round(result_rules.KOREK_MET.quantity,2) * round(result_rules.KOREK_MET.rate,2)/100 if result_rules.KOREK_MET else 0 +
           round(result_rules.KOREK.amount,2) * round(result_rules.KOREK.quantity,2) * round(result_rules.KOREK.rate,2)/100 if result_rules.KOREK else 0
         )
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_bruto_osn" model="hr.salary.rule">
        <field name="name">Bruto osnovica</field>
        <field name="sequence" eval="60" />
        <field name="code">BR_OSN</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.BR_OSN" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_rate = float(payslip.rule_parameter('KOEF_BO'))
result = round(result_rules.NETO.amount,2) * round(result_rules.NETO.quantity,2) * round(result_rules.NETO.rate,2)/100
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_obust" model="hr.salary.rule">
        <field name="name">Obustava 1</field>
        <field name="sequence" eval="100" />
        <field name="code">OB_1</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.OBUST" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = 0
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>


    <record id="hr_salary_rule_lic_odb" model="hr.salary.rule">
        <field name="name">Lični odbitak - umanjenje osnovice za porez</field>
        <field name="sequence" eval="299" />
        <field name="code">LIC_ODB</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.LIC_ODB" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_rate = contract.koef_lo * 100
if result_rate == 0:
   result_qty = 0
result = 300.00
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_porez" model="hr.salary.rule">
        <field name="name">Porez = Osnov(BR_OSN - D_IZ - LIC_ODB) x Por%</field>
        <field name="sequence" eval="300" />
        <field name="code">POREZ</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.POREZ" />
        <field name="condition_select">none</field>
        <field name="register_id" ref="contrib_register_por" />
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result_rate = float(payslip.rule_parameter('POREZ'))
osnovica = categories.BR_OSN - categories.D_IZ
lic_odb = categories.LIC_ODB
if lic_odb > osnovica:
    result = 0.00
else:
    result = osnovica - lic_odb
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_neto_pos" model="hr.salary.rule">
        <field name="name">NETO poslije poreza</field>
        <field name="sequence" eval="310" />
        <field name="code">NETO_POS</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.NETO_POS" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = categories.NETO - categories.POREZ
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

    <record id="hr_salary_rule_ukupno" model="hr.salary.rule">
        <field name="name">UKUPNO = Neto - Porez + Naknade - Obustave</field>
        <field name="sequence" eval="350" />
        <field name="code">UKUPNO</field>
        <field name="category_id" ref="l10n_bs_hr_payroll.UKUPNO" />
        <field name="register_id" ref="contrib_register_isp" />
        <field name="condition_select">none</field>
        <field name="amount_select">code</field>
        <field name="amount_python_compute">
result = categories.NETO_POS + categories.NAKN - categories.OBUST
result = round(result, int(payslip.rule_parameter('ZAOK')))
        </field>
        <field name="company_id" search="[('name','ilike','Fuelboss doo Zenica')]" model="res.company"/>
    </record>

</odoo>
